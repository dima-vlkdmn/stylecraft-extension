(()=>{"use strict";if(!window.__OFFSCREEN_INITIALIZED){window.__OFFSCREEN_INITIALIZED=!0,console.log("[Offscreen] script loaded.");let e=null,o=null,r=[],n=null,c=!1;function s(s){if(e){r=[];try{o=new MediaRecorder(e,{mimeType:"video/webm; codecs=vp8",videoBitsPerSecond:15e5})}catch(e){return console.error("[Offscreen] MediaRecorder init failed:",e),void s({ok:!1,error:e.message})}o.ondataavailable=e=>{e.data&&e.data.size>0&&r.push(e.data)},o.onstop=()=>{const e=new Blob(r,{type:"video/webm"}),s=URL.createObjectURL(e);console.log("[Offscreen] Recording stopped, URL:",s),null==n||n({ok:!0,gifUrl:s}),n=null,c=!1,o=null},o.start(Math.floor(1e3/60)),c=!0,console.log("[Offscreen] Recording started."),s({ok:!0})}else s({ok:!1,error:"No stream available"})}function t(o,r){c?o({ok:!1,error:"Already recording"}):e?s(o):navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1}).then((r=>{e=r,s(o)})).catch((e=>{console.error("[Offscreen] getDisplayMedia failed:",e),o({ok:!1,error:e.message||"getDisplayMedia error"})}))}function a(e){c&&o?(n=e,o.stop()):e({ok:!1,error:"No active recording"})}function i(e){o&&"recording"===o.state?(o.pause(),e({ok:!0})):e({ok:!1,error:"Cannot pause"})}function d(e){o&&"paused"===o.state?(o.resume(),e({ok:!0})):e({ok:!1,error:"Cannot resume"})}chrome.runtime.onMessage.addListener(((e,o,r)=>{var n;if("offscreen"!==e.target)return!1;switch(e.action){case"startRecording":return console.log("[Offscreen] Received startRecording"),t(r,null===(n=e.data)||void 0===n||n.crop),!0;case"stopRecording":return console.log("[Offscreen] Received stopRecording"),a(r),!0;case"pauseRecording":return console.log("[Offscreen] Received pauseRecording"),i(r),!0;case"resumeRecording":return console.log("[Offscreen] Received resumeRecording"),d(r),!0;default:return r({ok:!1,error:"Unknown action"}),!1}}))}})();